<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultra Cooperative Management System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
    font-family:"Times New Roman", serif;
    background: linear-gradient(to right,#4e73df,#1cc88a);
    min-height:100vh;
    display:flex;
    justify-content:center;
    padding:40px;
}
.dashboard-box{
    width:100%;
    max-width:1000px;
    background:white;
    padding:30px;
    border-radius:20px;
    box-shadow:0 8px 40px rgba(0,0,0,0.25);
}
.summary-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    margin-top:25px;
}
.card-item{
    background:linear-gradient(135deg, #00cfff33, #1cc88a33);
    padding:25px;
    border-radius:16px;
    font-weight:bold;
    text-align:center;
    transition:0.3s;
}
.card-item:hover{
    transform:translateY(-5px);
}
.logout-btn{
    margin-top:25px;
}
#financeChart{
    max-height:400px;
}
</style>
</head>
<body>

<div class="dashboard-box">

<h3 class="text-center">🏦 Geresu Dhuki Cooperative Dashboard</h3>
<h5 id="welcomeUser" class="text-center text-primary"></h5>

<div class="summary-grid">
<div class="card-item" id="membersCard">Total Members: 0</div>
<div class="card-item" id="savingsCard">Total Savings: 0 ETB</div>
<div class="card-item" id="loanCard">Total Loans: 0 ETB</div>
<div class="card-item" id="penaltyCard">Total Penalty: 0 ETB</div>
</div>

<canvas id="financeChart" class="mt-4"></canvas>

<button class="btn btn-danger w-100 logout-btn" onclick="logout()">Logout</button>

</div>

<script>
/* =======================
   LOGIN & SESSION CHECK
======================= */
const user = JSON.parse(localStorage.getItem("loggedIn") || "null");
if(!user){ window.location.href = "index.html"; }
else{ document.getElementById("welcomeUser").innerText = "Welcome Admin " + (user.name || "User"); }

/* =======================
   MEMBERS DATA MANAGEMENT
======================= */
let members = JSON.parse(localStorage.getItem("accounts") || "[]");

/* Example financial logic */
const savingsPerMember = 1000;
const loanPerMember = 500;
const penaltyRate = 0.02;

/* Automatic monthly penalty calculation */
function calculatePenalty(member){
    if(!member.lastPaymentDate) return savingsPerMember * penaltyRate;
    const today = new Date();
    const last = new Date(member.lastPaymentDate);
    const monthsLate = (today.getFullYear()-last.getFullYear())*12 + (today.getMonth()-last.getMonth());
    return monthsLate > 0 ? savingsPerMember * penaltyRate * monthsLate : 0;
}

/* Calculate totals */
let totalMembers = members.length;
let totalSavings = totalMembers * savingsPerMember;
let totalLoans = totalMembers * loanPerMember;
let totalPenalty = members.reduce((sum,m)=> sum + calculatePenalty(m), 0);

/* =======================
   DISPLAY CARDS
======================= */
document.getElementById("membersCard").innerText = "Total Members: " + totalMembers;
document.getElementById("savingsCard").innerText = "Total Savings: " + totalSavings.toFixed(2) + " ETB";
document.getElementById("loanCard").innerText = "Total Loans: " + totalLoans.toFixed(2) + " ETB";
document.getElementById("penaltyCard").innerText = "Total Penalty: " + totalPenalty.toFixed(2) + " ETB";

/* =======================
   CHART VISUALIZATION
======================= */
window.addEventListener("load", ()=>{
    const ctx = document.getElementById("financeChart");
    new Chart(ctx,{
        type:"bar",
        data:{
            labels:["Members","Savings","Loans","Penalty"],
            datasets:[{
                label:"Cooperative Analytics",
                data:[totalMembers,totalSavings,totalLoans,totalPenalty],
                backgroundColor:[
                    "rgba(54,162,235,0.6)",
                    "rgba(75,192,192,0.6)",
                    "rgba(255,206,86,0.6)",
                    "rgba(255,99,132,0.6)"
                ]
            }]
        },
        options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
                legend:{display:true}
            }
        }
    });
});

/* =======================
   LOGOUT
======================= */
function logout(){
    localStorage.removeItem("loggedIn");
    window.location.href="index.html";
}
</script>

</body>
</html>